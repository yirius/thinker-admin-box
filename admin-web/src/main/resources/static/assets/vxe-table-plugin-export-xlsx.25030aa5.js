import{a as xe}from"./@kangc.f912404d.js";import{x as ye}from"./xe-utils.a7d87cf6.js";import{e as Ce}from"./exceljs.3364a90c.js";var ne={};(function(R){Object.defineProperty(R,"__esModule",{value:!0}),R.default=R.VXETablePluginExportXLSX=void 0;var D=Q(ye),J=Q(Ce.exports);function Q(e){return e&&e.__esModule?e:{default:e}}var F,ie="f8f8f9",I="606266",H="thin",O="e8eaec";function Y(e,t){if(t)switch(e.cellType){case"string":return D.default.toValueString(t);case"number":if(!isNaN(t))return Number(t);break;default:if(t.length<12&&!isNaN(t))return Number(t);break}return t}function le(e,t){var a=e.footerFilterMethod;return a?t.filter(function(f,u){return a({items:f,$rowIndex:u})}):t}function se(e,t,a,f){var u=Y(f,a[e.getVMColumnIndex(f)]);return u}function Z(e){var t=e.childNodes,a=t&&t.length;return a?Z(t[0]):e}function P(e,t){t&&(e.height=D.default.floor(t*.75,12))}function U(e,t){e.protection={locked:!1},e.alignment={vertical:"middle",horizontal:t||"left"}}function V(){return{top:{style:H,color:{argb:O}},left:{style:H,color:{argb:O}},bottom:{style:H,color:{argb:O}},right:{style:H,color:{argb:O}}}}function fe(e){var t="xlsx",a=F,f=a.modal,u=a.t,c=e.$table,s=e.options,v=e.columns,b=e.colgroups,y=e.datas,g=c.props,B=c.reactData,q=g.headerAlign,C=g.align,z=g.footerAlign,_=B.rowHeight,L=s.message,E=s.sheetName,k=s.isHeader,T=s.isFooter,A=s.isMerge,G=s.isColgroup,w=s.original,d=s.useStyle,m=s.sheetMethod,N=L!==!1,S=c.getMergeCells(),X=[],ee=[],te=[],j=[],M=0,re={};v.forEach(function(l){var i=l.id,o=l.property,r=l.renderWidth;re[i]=w?o:l.getTitle(),te.push({key:i,width:D.default.ceil(r/8,1)})}),k&&(G&&!w&&b?b.forEach(function(l,i){var o={};v.forEach(function(r){o[r.id]=null}),l.forEach(function(r){var n=r._colSpan,p=r._rowSpan,h=Z(r),x=v.indexOf(h);o[h.id]=w?h.property:r.getTitle(),(n>1||p>1)&&j.push({s:{r:i,c:x},e:{r:i+p-1,c:x+n-1}})}),X.push(o)}):X.push(re),M+=X.length),A&&!w&&S.forEach(function(l){var i=l.row,o=l.rowspan,r=l.col,n=l.colspan;j.push({s:{r:i+M,c:r},e:{r:i+M+o-1,c:r+n-1}})});var oe=y.map(function(l){var i={};return v.forEach(function(o){i[o.id]=Y(o,l[o.id])}),i});if(M+=oe.length,T){var he=c.getTableData(),be=he.footerData,me=le(s,be),we=c.getMergeFooterItems();A&&!w&&we.forEach(function(l){var i=l.row,o=l.rowspan,r=l.col,n=l.colspan;j.push({s:{r:i+M,c:r},e:{r:i+M+o-1,c:r+n-1}})}),me.forEach(function(l){var i={};v.forEach(function(o){i[o.id]=se(c,s,l,o)}),ee.push(i)})}var ae=function(){var i=new J.default.Workbook,o=i.addWorksheet(E);i.creator="vxe-table",o.columns=te,k&&o.addRows(X).forEach(function(r){d&&P(r,_),r.eachCell(function(n){var p=o.getColumn(n.col),h=c.getColumnById(p.key),x=h.headerAlign,K=h.align;U(n,x||K||q||C),d&&Object.assign(n,{font:{bold:!0,color:{argb:I}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:ie}},border:V()})})}),o.addRows(oe).forEach(function(r){d&&P(r,_),r.eachCell(function(n){var p=o.getColumn(n.col),h=c.getColumnById(p.key),x=h.align;U(n,x||C),d&&Object.assign(n,{font:{color:{argb:I}},border:V()})})}),T&&o.addRows(ee).forEach(function(r){d&&P(r,_),r.eachCell(function(n){var p=o.getColumn(n.col),h=c.getColumnById(p.key),x=h.footerAlign,K=h.align;U(n,x||K||z||C),d&&Object.assign(n,{font:{color:{argb:I}},border:V()})})}),d&&m&&m({options:s,workbook:i,worksheet:o,columns:v,colgroups:b,datas:y,$table:c}),j.forEach(function(r){var n=r.s,p=r.e;o.mergeCells(n.r+1,n.c+1,p.r+1,p.c+1)}),i.xlsx.writeBuffer().then(function(r){var n=new Blob([r],{type:"application/octet-stream"});ue(e,n,s),N&&f&&(f.close(t),f.message({content:u("vxe.table.expSuccess"),status:"success"}))})};N&&f?(f.message({id:t,content:u("vxe.table.expLoading"),status:"loading",duration:-1}),setTimeout(ae,1500)):ae()}function ue(e,t,a){var f=F,u=f.modal,c=f.t,s=a.message,v=a.filename,b=a.type,y=s!==!1;if(window.Blob)if(navigator.msSaveBlob)navigator.msSaveBlob(t,"".concat(v,".").concat(b));else{var g=document.createElement("a");g.target="_blank",g.download="".concat(v,".").concat(b),g.href=URL.createObjectURL(t),document.body.appendChild(g),g.click(),document.body.removeChild(g)}else y&&u&&u.alert({content:c("vxe.error.notExp"),status:"error"})}function ce(e,t){return t.some(function(a){return e.indexOf(a)>-1})}function $(e){var t=F,a=t.modal,f=t.t,u=e.$table,c=e.options,s=u.internalData,v=s._importReject,b=c.message!==!1;b&&a&&a.message({content:f("vxe.error.impFields"),status:"error"}),v&&v({status:!1})}function de(e){var t=F,a=t.modal,f=t.t,u=e.$table,c=e.columns,s=e.options,v=e.file,b=u.internalData,y=b._importResolve,g=s.message!==!1,B=new FileReader;B.onerror=function(){$(e)},B.onload=function(q){var C=[];c.forEach(function(L){var E=L.property;E&&C.push(E)});var z=new J.default.Workbook,_=q.target;_?z.xlsx.load(_.result).then(function(L){var E=L.worksheets[0];if(E){var k=E.getSheetValues(),T=D.default.findIndexOf(k,function(d){return d&&d.length>0}),A=k[T],G=ce(C,A);if(G){var w=k.slice(T).map(function(d){var m={};d.forEach(function(S,X){m[A[X]]=S});var N={};return C.forEach(function(S){N[S]=D.default.isUndefined(m[S])?null:m[S]}),N});u.createData(w).then(function(d){var m;return s.mode==="insert"?m=u.insertAt(d,-1):m=u.reloadData(d),m.then(function(){y&&y({status:!0})})}),g&&a&&a.message({content:f("vxe.table.impSuccess",[w.length]),status:"success"})}else $(e)}else $(e)}):$(e)},B.readAsArrayBuffer(v)}function ve(e){if(e.options.type==="xlsx")return de(e),!1}function ge(e){if(e.options.type==="xlsx")return fe(e),!1}var W={install:function(t){var a=t.setup,f=t.interceptor;F=t,a({export:{types:{xlsx:0}}}),f.mixin({"event.import":ve,"event.export":ge})}};R.VXETablePluginExportXLSX=W,typeof window!="undefined"&&window.VXETable&&window.VXETable.use&&window.VXETable.use(W);var pe=W;R.default=pe})(ne);var ke=xe(ne);export{ke as V};
