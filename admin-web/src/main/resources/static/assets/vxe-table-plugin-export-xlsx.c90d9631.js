import{a as e}from"./@kangc.ff3ddaf0.js";import{x as t}from"./xe-utils.a7d87cf6.js";import{e as o}from"./exceljs.61d36b19.js";var n={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.VXETablePluginExportXLSX=void 0;var n,r=i(t),a=i(o.exports);function i(e){return e&&e.__esModule?e:{default:e}}var l="606266",c="thin",s="e8eaec";function u(e,t){if(t)switch(e.cellType){case"string":return r.default.toValueString(t);case"number":if(!isNaN(t))return Number(t);break;default:if(t.length<12&&!isNaN(t))return Number(t)}return t}function f(e){var t=e.childNodes;return t&&t.length?f(t[0]):e}function d(e,t){t&&(e.height=r.default.floor(.75*t,12))}function g(e,t){e.protection={locked:!1},e.alignment={vertical:"middle",horizontal:t||"left"}}function p(){return{top:{style:c,color:{argb:s}},left:{style:c,color:{argb:s}},bottom:{style:c,color:{argb:s}},right:{style:c,color:{argb:s}}}}function h(e){var t="xlsx",o=n,i=o.modal,c=o.t,s=e.$table,h=e.options,m=e.columns,v=e.colgroups,b=e.datas,x=s.props,w=s.reactData,y=x.headerAlign,E=x.align,k=x.footerAlign,C=w.rowHeight,S=h.message,j=h.sheetName,T=h.isHeader,B=h.isFooter,V=h.isMerge,X=h.isColgroup,_=h.original,M=h.useStyle,N=h.sheetMethod,O=!1!==S,R=s.getMergeCells(),A=[],D=[],I=[],F=[],L=0,$={};m.forEach((function(e){var t=e.id,o=e.property,n=e.renderWidth;$[t]=_?o:e.getTitle(),I.push({key:t,width:r.default.ceil(n/8,1)})})),T&&(X&&!_&&v?v.forEach((function(e,t){var o={};m.forEach((function(e){o[e.id]=null})),e.forEach((function(e){var n=e._colSpan,r=e._rowSpan,a=f(e),i=m.indexOf(a);o[a.id]=_?a.property:e.getTitle(),(n>1||r>1)&&F.push({s:{r:t,c:i},e:{r:t+r-1,c:i+n-1}})})),A.push(o)})):A.push($),L+=A.length),V&&!_&&R.forEach((function(e){var t=e.row,o=e.rowspan,n=e.col,r=e.colspan;F.push({s:{r:t+L,c:n},e:{r:t+L+o-1,c:n+r-1}})}));var W=b.map((function(e){var t={};return m.forEach((function(o){t[o.id]=u(o,e[o.id])})),t}));if(L+=W.length,B){var P=s.getTableData().footerData,U=function(e,t){var o=e.footerFilterMethod;return o?t.filter((function(e,t){return o({items:e,$rowIndex:t})})):t}(h,P),H=s.getMergeFooterItems();V&&!_&&H.forEach((function(e){var t=e.row,o=e.rowspan,n=e.col,r=e.colspan;F.push({s:{r:t+L,c:n},e:{r:t+L+o-1,c:n+r-1}})})),U.forEach((function(e){var t={};m.forEach((function(o){t[o.id]=function(e,t,o,n){return u(n,o[e.getVMColumnIndex(n)])}(s,0,e,o)})),D.push(t)}))}var z=function(){var e=new a.default.Workbook,o=e.addWorksheet(j);e.creator="vxe-table",o.columns=I,T&&o.addRows(A).forEach((function(e){M&&d(e,C),e.eachCell((function(e){var t=o.getColumn(e.col),n=s.getColumnById(t.key),r=n.headerAlign,a=n.align;g(e,r||a||y||E),M&&Object.assign(e,{font:{bold:!0,color:{argb:l}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"f8f8f9"}},border:p()})}))})),o.addRows(W).forEach((function(e){M&&d(e,C),e.eachCell((function(e){var t=o.getColumn(e.col);g(e,s.getColumnById(t.key).align||E),M&&Object.assign(e,{font:{color:{argb:l}},border:p()})}))})),B&&o.addRows(D).forEach((function(e){M&&d(e,C),e.eachCell((function(e){var t=o.getColumn(e.col),n=s.getColumnById(t.key),r=n.footerAlign,a=n.align;g(e,r||a||k||E),M&&Object.assign(e,{font:{color:{argb:l}},border:p()})}))})),M&&N&&N({options:h,workbook:e,worksheet:o,columns:m,colgroups:v,datas:b,$table:s}),F.forEach((function(e){var t=e.s,n=e.e;o.mergeCells(t.r+1,t.c+1,n.r+1,n.c+1)})),e.xlsx.writeBuffer().then((function(e){!function(e,t,o){var r=n,a=r.modal,i=r.t,l=o.message,c=o.filename,s=o.type,u=!1!==l;if(window.Blob)if(navigator.msSaveBlob)navigator.msSaveBlob(t,"".concat(c,".").concat(s));else{var f=document.createElement("a");f.target="_blank",f.download="".concat(c,".").concat(s),f.href=URL.createObjectURL(t),document.body.appendChild(f),f.click(),document.body.removeChild(f)}else u&&a&&a.alert({content:i("vxe.error.notExp"),status:"error"})}(0,new Blob([e],{type:"application/octet-stream"}),h),O&&i&&(i.close(t),i.message({content:c("vxe.table.expSuccess"),status:"success"}))}))};O&&i?(i.message({id:t,content:c("vxe.table.expLoading"),status:"loading",duration:-1}),setTimeout(z,1500)):z()}function m(e){var t=n,o=t.modal,r=t.t,a=e.$table,i=e.options,l=a.internalData._importReject;!1!==i.message&&o&&o.message({content:r("vxe.error.impFields"),status:"error"}),l&&l({status:!1})}function v(e){if("xlsx"===e.options.type)return function(e){var t=n,o=t.modal,i=t.t,l=e.$table,c=e.columns,s=e.options,u=e.file,f=l.internalData._importResolve,d=!1!==s.message,g=new FileReader;g.onerror=function(){m(e)},g.onload=function(t){var n=[];c.forEach((function(e){var t=e.property;t&&n.push(t)}));var u=new a.default.Workbook,g=t.target;g?u.xlsx.load(g.result).then((function(t){var a=t.worksheets[0];if(a){var c=a.getSheetValues(),u=r.default.findIndexOf(c,(function(e){return e&&e.length>0})),g=c[u],p=function(e,t){return t.some((function(t){return e.indexOf(t)>-1}))}(n,g);if(p){var h=c.slice(u).map((function(e){var t={};e.forEach((function(e,o){t[g[o]]=e}));var o={};return n.forEach((function(e){o[e]=r.default.isUndefined(t[e])?null:t[e]})),o}));l.createData(h).then((function(e){return("insert"===s.mode?l.insertAt(e,-1):l.reloadData(e)).then((function(){f&&f({status:!0})}))})),d&&o&&o.message({content:i("vxe.table.impSuccess",[h.length]),status:"success"})}else m(e)}else m(e)})):m(e)},g.readAsArrayBuffer(u)}(e),!1}function b(e){if("xlsx"===e.options.type)return h(e),!1}var x={install:function(e){var t=e.setup,o=e.interceptor;n=e,t({export:{types:{xlsx:0}}}),o.mixin({"event.import":v,"event.export":b})}};e.VXETablePluginExportXLSX=x,"undefined"!=typeof window&&window.VXETable&&window.VXETable.use&&window.VXETable.use(x);var w=x;e.default=w}(n);var r=e(n);export{r as V};
