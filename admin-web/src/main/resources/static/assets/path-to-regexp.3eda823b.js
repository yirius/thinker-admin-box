function D(r){for(var i=[],e=0;e<r.length;){var u=r[e];if(u==="*"||u==="+"||u==="?"){i.push({type:"MODIFIER",index:e,value:r[e++]});continue}if(u==="\\"){i.push({type:"ESCAPED_CHAR",index:e++,value:r[e++]});continue}if(u==="{"){i.push({type:"OPEN",index:e,value:r[e++]});continue}if(u==="}"){i.push({type:"CLOSE",index:e,value:r[e++]});continue}if(u===":"){for(var v="",n=e+1;n<r.length;){var t=r.charCodeAt(n);if(t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||t===95){v+=r[n++];continue}break}if(!v)throw new TypeError("Missing parameter name at "+e);i.push({type:"NAME",index:e,value:v}),e=n;continue}if(u==="("){var x=1,d="",n=e+1;if(r[n]==="?")throw new TypeError('Pattern cannot start with "?" at '+n);for(;n<r.length;){if(r[n]==="\\"){d+=r[n++]+r[n++];continue}if(r[n]===")"){if(x--,x===0){n++;break}}else if(r[n]==="("&&(x++,r[n+1]!=="?"))throw new TypeError("Capturing groups are not allowed at "+n);d+=r[n++]}if(x)throw new TypeError("Unbalanced pattern at "+e);if(!d)throw new TypeError("Missing pattern at "+e);i.push({type:"PATTERN",index:e,value:d}),e=n;continue}i.push({type:"CHAR",index:e,value:r[e++]})}return i.push({type:"END",index:e,value:""}),i}function M(r,i){i===void 0&&(i={});for(var e=D(r),u=i.prefixes,v=u===void 0?"./":u,n="[^"+o(i.delimiter||"/#?")+"]+?",t=[],x=0,d=0,p="",f=function(g){if(d<e.length&&e[d].type===g)return e[d++].value},R=function(g){var m=f(g);if(m!==void 0)return m;var C=e[d],P=C.type,O=C.index;throw new TypeError("Unexpected "+P+" at "+O+", expected "+g)},h=function(){for(var g="",m;m=f("CHAR")||f("ESCAPED_CHAR");)g+=m;return g};d<e.length;){var l=f("CHAR"),s=f("NAME"),y=f("PATTERN");if(s||y){var a=l||"";v.indexOf(a)===-1&&(p+=a,a=""),p&&(t.push(p),p=""),t.push({name:s||x++,prefix:a,suffix:"",pattern:y||n,modifier:f("MODIFIER")||""});continue}var E=l||f("ESCAPED_CHAR");if(E){p+=E;continue}p&&(t.push(p),p="");var w=f("OPEN");if(w){var a=h(),A=f("NAME")||"",c=f("PATTERN")||"",T=h();R("CLOSE"),t.push({name:A||(c?x++:""),pattern:A&&!c?n:c,prefix:a,suffix:T,modifier:f("MODIFIER")||""});continue}R("END")}return t}function o(r){return r.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function N(r){return r&&r.sensitive?"":"i"}function H(r,i){if(!i)return r;for(var e=/\((?:\?<(.*?)>)?(?!\?)/g,u=0,v=e.exec(r.source);v;)i.push({name:v[1]||u++,prefix:"",suffix:"",modifier:"",pattern:""}),v=e.exec(r.source);return r}function I(r,i,e){var u=r.map(function(v){return $(v,i,e).source});return new RegExp("(?:"+u.join("|")+")",N(e))}function S(r,i,e){return b(M(r,e),i,e)}function b(r,i,e){e===void 0&&(e={});for(var u=e.strict,v=u===void 0?!1:u,n=e.start,t=n===void 0?!0:n,x=e.end,d=x===void 0?!0:x,p=e.encode,f=p===void 0?function(g){return g}:p,R="["+o(e.endsWith||"")+"]|$",h="["+o(e.delimiter||"/#?")+"]",l=t?"^":"",s=0,y=r;s<y.length;s++){var a=y[s];if(typeof a=="string")l+=o(f(a));else{var E=o(f(a.prefix)),w=o(f(a.suffix));if(a.pattern)if(i&&i.push(a),E||w)if(a.modifier==="+"||a.modifier==="*"){var A=a.modifier==="*"?"?":"";l+="(?:"+E+"((?:"+a.pattern+")(?:"+w+E+"(?:"+a.pattern+"))*)"+w+")"+A}else l+="(?:"+E+"("+a.pattern+")"+w+")"+a.modifier;else l+="("+a.pattern+")"+a.modifier;else l+="(?:"+E+w+")"+a.modifier}}if(d)v||(l+=h+"?"),l+=e.endsWith?"(?="+R+")":"$";else{var c=r[r.length-1],T=typeof c=="string"?h.indexOf(c[c.length-1])>-1:c===void 0;v||(l+="(?:"+h+"(?="+R+"))?"),T||(l+="(?="+h+"|"+R+")")}return new RegExp(l,N(e))}function $(r,i,e){return r instanceof RegExp?H(r,i):Array.isArray(r)?I(r,i,e):S(r,i,e)}export{$ as p};
